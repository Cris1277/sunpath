document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("weatherDisplay"),t=document.getElementById("forecastDisplay"),a=document.getElementById("searchBtn"),n=document.getElementById("cityInput"),c=document.getElementById("celsiusBtn"),i=document.getElementById("fahrenheitBtn"),r=document.getElementById("temperatureChart").getContext("2d"),d=document.getElementById("precipitationChart").getContext("2d"),o=document.getElementById("windSpeedChart").getContext("2d");let s,l,m,p="metric";async function y(a){try{const c=await fetch(`https://api.weatherapi.com/v1/forecast.json?key=a9b7f097937046b4b1d131943251501&q=${a}&days=7&lang=es`);if(!c.ok)throw new Error("Ciudad no encontrada");const i=await c.json();!function(t){const{name:a}=t.location,n="metric"===p?t.current.temp_c:t.current.temp_f,{text:c,icon:i}=t.current.condition;e.innerHTML=`\n<h2>📍 Ciudad: ${a}</h2>\n<p>🌡️ Temperatura: ${n}°${"metric"===p?"C":"F"}</p>\n<p>☁️ Estado: ${c}</p>\n<img src="https:${i}" alt="${c}">\n`}(i),n=i.forecast.forecastday,t.innerHTML="",n.forEach((e=>{const{date:a}=e,n="metric"===p?e.day.maxtemp_c:e.day.maxtemp_f,c="metric"===p?e.day.mintemp_c:e.day.mintemp_f,{text:i,icon:r}=e.day.condition;t.innerHTML+=`\n     <div class="forecast-day">\n         <h4>${a}</h4>\n         <img src="https:${r}" alt="${i}">\n         <p>🌡️ Máx: ${n}°${"metric"===p?"C":"F"}</p>\n         <p>🌡️ Mín: ${c}°${"metric"===p?"C":"F"}</p>\n         <p>☁️ ${i}</p>\n     </div>\n `})),document.querySelectorAll(".chart-container").forEach((e=>{e.style.display="block"})),function(e){const t=e.map((e=>e.date)),a=e.map((e=>"metric"===p?e.day.avgtemp_c:e.day.avgtemp_f)),n=e.map((e=>e.day.totalprecip_mm)),c=e.map((e=>e.day.maxwind_kph));s&&s.destroy();l&&l.destroy();m&&m.destroy();s=u(r,"Temperatura Promedio",{labels:t,values:a},"rgba(255, 99, 132, 0.6)","°"+("metric"===p?"C":"F")),l=u(d,"Precipitación Total",{labels:t,values:n},"rgba(54, 162, 235, 0.6)","mm"),m=u(o,"Velocidad Máxima del Viento",{labels:t,values:c},"rgba(75, 192, 192, 0.6)","kph")}(i.forecast.forecastday)}catch(e){alert(e.message)}var n}function u(e,t,a,n,c){return new Chart(e,{type:"line",data:{labels:a.labels,datasets:[{label:t,data:a.values,backgroundColor:n,borderColor:n,fill:!1,tension:.1}]},options:{responsive:!0,plugins:{legend:{display:!0}},scales:{y:{beginAtZero:!0,ticks:{callback:function(e){return`${e} ${c}`}}}}}})}a.addEventListener("click",(()=>{const e=n.value.trim();e&&y(e)})),c.addEventListener("click",(()=>{p="metric",c.classList.add("active"),i.classList.remove("active")})),i.addEventListener("click",(()=>{p="imperial",i.classList.add("active"),c.classList.remove("active")}))}));
